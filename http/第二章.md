### **HTTP报文内的HTTP信息**

之前有简单介绍过HTTP报文的格式。报文包括报文头、首部字段和报文主体。

#### **编码提升效率**

HTTP在传输数据时可以按照数据原貌直接传输，也可以传输过程中通过编码提升传输效率。

- 压缩传输的内容编码
- 分割发送的分块传输编码

#### **发送多种数据的多部分对象集合**

发送邮件时，我们可以在邮件里写入文字并添加多份邮件。这是因为采用了MIME（Multipurpose Internet Mail Extensions，多用途因特网邮件扩展）机制，允许处理文本、图像等多种不同类型的数据。

同样，HTTP也采用多部分对象集合，发送的一份报文主体可以含有多类型实体。

常见的多部分对象集合包含的对象如下：

- multipart/form-data

  在web表单文件上传时使用

- multipart/byteranges

  状态码206（partial content，部分内容），响应报文包含了多个范围的内容时使用。

#### **获取部分内容的范围请求**

多线程下载器之所以可以多线程下载，是因为其可以在多个线程内分段请求数据。

在请求报文里面，可以用**首部字段Range**来指定资源的byte范围

`Range: bytes=5001 - 10000`

#### **内容协商返回页面**

有时同一个web网站可能有多个相同内容的页面，比如英文版和中文版的区别。浏览器可以根据你设置的默认语言返回中文或英文的页面。这种机制称为**内容协商(Content Negotiation)**。

本质上是客户端和服务端就交换的内容进行一些协商。在请求报文中的一些首部字段中可以作为判断的基准：

- Accept
- Accept-Charset
- Accept-Language

### **返回结果的HTTP状态**

|      | 类别             | 原因短语                   |
| ---- | ---------------- | -------------------------- |
| 1XX  | 信息性状态码     | 接收到的请求正在处理       |
| 2XX  | 成功状态码       | 请求正常处理完毕           |
| 3XX  | 重定向状态码     | 需要进行附加操作以完成请求 |
| 4XX  | 客户端错误状态码 | 服务器无法处理请求         |
| 5XX  | 服务端错误状态码 | 服务器处理请求出错         |

### **与HTTP协作的Web服务器**

HTTP/1.1允许一台服务器商搭建多个web站点。这样在DNS服务器上多个域名对应的是一个IP地址。所以在发送请求时，必须在host首部完整指定逐级名或域名的URI。

#### **通信数据转发程序：代理、网关、隧道**

**代理**

代理很好懂，就是所有的请求和响应都通过一个中间服务器，客户端和服务端都只与代理服务器通信。

每次通过代理服务器转发请求或响应时，会追加写入`Via`首部信息。

代理可以按两种基准分类：一种是是否使用缓存，另一种是是否会修改报文。

**缓存代理**：代理转发响应时，缓存代理（Caching Proxy）会预先将资源的副本保存在代理服务器上

**透明代理：**不对报文做任何修改的称为透明代理（Transparent Proxy），否则是非透明代理。

**网关**

网关是一个网络的进出口，另一个网络的数据需要通过网关才能进入本地网络。一般的家庭路由器就是一种网关。

**隧道**

隧道可以按要求建立一条与其它服务器的通信线路，使用SSL等加密手段进行通信。